---
phase: 01-foundation-architecture
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - tsdown.config.ts
  - biome.json
  - vitest.config.ts
autonomous: true

must_haves:
  truths:
    - "Developer can build ESM and CommonJS bundles using npm run build"
    - "Developer can run tests using npm test"
    - "Biome linter catches any types in code"
  artifacts:
    - path: "tsdown.config.ts"
      provides: "Build configuration for dual ESM/CJS output"
      contains: 'format: ["esm", "cjs"]'
    - path: "biome.json"
      provides: "Linter and formatter configuration"
      contains: "noExplicitAny"
    - path: "vitest.config.ts"
      provides: "Test framework configuration"
      contains: "coverage"
  key_links:
    - from: "tsdown.config.ts"
      to: "src/index.ts"
      via: "Entry point configuration"
      pattern: 'entry: "src/index.ts"'
---

<objective>
Configure build tooling, linter, and test framework to enforce quality constraints and enable dual ESM/CommonJS output.

Purpose: Set up tsdown for tree-shakeable builds (PLAT-06-09), Biome to catch any types (DX-02), and Vitest for fast testing. This prevents Pitfall #2 (bundle bloat) and Pitfall #3 (missing strict types).

Output: Working tsdown.config.ts, biome.json, and vitest.config.ts ready for Phase 2 implementation work.
</objective>

<execution_context>
@/Users/medelman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/medelman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/medelman/GitHub/medelman17/eyecitets/.planning/PROJECT.md
@/Users/medelman/GitHub/medelman17/eyecitets/.planning/ROADMAP.md
@/Users/medelman/GitHub/medelman17/eyecitets/.planning/phases/01-foundation-architecture/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Create tsdown.config.ts for dual ESM/CJS bundle output</name>
  <files>tsdown.config.ts</files>
  <action>
Create tsdown.config.ts with dual format output:
```typescript
import { defineConfig } from "tsdown"

export default defineConfig({
  entry: "src/index.ts",
  format: ["esm", "cjs"],
  dts: true,
  minify: true,
  sourcemap: true,
  outDir: "dist",
  declaration: {
    resolve: true,
  },
})
```

Configuration rationale:
- entry: "src/index.ts" → Main entry point (will be created in plan 03)
- format: ["esm", "cjs"] → Dual output satisfies PLAT-06, PLAT-07
- dts: true → Generate TypeScript declarations (PLAT-08, DX-01)
- minify: true → Reduce bundle size toward <50KB goal
- sourcemap: true → Debugging support for consumers
- declaration.resolve: true → Resolve types to dependencies for better IDE experience

Note: We do NOT use exports: true auto-generation because package.json exports are already manually configured in plan 01 with correct types-first ordering. Auto-generation might override our careful ordering.
  </action>
  <verify>cat tsdown.config.ts | grep -E 'format.*esm.*cjs|dts.*true|minify.*true'</verify>
  <done>tsdown.config.ts exists with dual ESM/CJS format, declaration generation enabled, minification enabled</done>
</task>

<task type="auto">
  <name>Create biome.json with strict type linting rules</name>
  <files>biome.json</files>
  <action>
Create biome.json with strict linting to catch any types:
```json
{
  "$schema": "https://biomejs.dev/schemas/1.9.4/schema.json",
  "organizeImports": {
    "enabled": true
  },
  "linter": {
    "enabled": true,
    "rules": {
      "recommended": true,
      "suspicious": {
        "noExplicitAny": "error",
        "noImplicitAnyLet": "error"
      },
      "style": {
        "noNonNullAssertion": "warn",
        "noParameterAssign": "error",
        "useConst": "error"
      },
      "complexity": {
        "noForEach": "off"
      }
    }
  },
  "formatter": {
    "enabled": true,
    "lineWidth": 100,
    "indentStyle": "space",
    "indentWidth": 2
  },
  "javascript": {
    "formatter": {
      "quoteStyle": "double",
      "trailingCommas": "all",
      "semicolons": "asNeeded"
    }
  }
}
```

Key rules for DX-01/DX-02:
- noExplicitAny: "error" → Catches `any` types in code
- noImplicitAnyLet: "error" → Catches implicit any from let declarations
- useConst: "error" → Enforces immutability patterns
- noParameterAssign: "error" → Prevents common mutation bugs in parsing logic

Why Biome: Single tool replaces ESLint + Prettier, 10-25x faster, type-aware linting integrated.
  </action>
  <verify>cat biome.json | grep -E '"noExplicitAny".*"error"|"noImplicitAnyLet".*"error"'</verify>
  <done>biome.json exists with noExplicitAny and noImplicitAnyLet set to error, formatter configured</done>
</task>

<task type="auto">
  <name>Create vitest.config.ts for Node.js and browser testing</name>
  <files>vitest.config.ts</files>
  <action>
Create vitest.config.ts with coverage configuration:
```typescript
import { defineConfig } from "vitest/config"

export default defineConfig({
  test: {
    globals: true,
    environment: "node",
    include: ["tests/**/*.test.ts"],
    coverage: {
      provider: "v8",
      reporter: ["text", "json", "html"],
      include: ["src/**/*.ts"],
      exclude: ["src/**/*.test.ts", "src/types/**"],
      lines: 80,
      functions: 80,
      branches: 75,
      statements: 80,
    },
    testTimeout: 10000,
  },
})
```

Configuration rationale:
- globals: true → No need to import describe/it/expect in every test file
- environment: "node" → Default to Node.js (can override per-test for browser with @vitest-environment jsdom)
- testTimeout: 10000 → Long timeout for ReDoS testing in Phase 2 (regex performance validation)
- coverage thresholds: 80% lines/functions/statements, 75% branches (standard for libraries)
- exclude types from coverage → Type definitions don't need test coverage
- provider: "v8" → Built-in coverage, no extra dependencies

Why Vitest: 10-20x faster than Jest, native TypeScript/ESM support, no ts-jest overhead.
  </action>
  <verify>cat vitest.config.ts | grep -E 'provider.*v8|testTimeout.*10000|lines.*80'</verify>
  <done>vitest.config.ts exists with v8 coverage provider, 10-second timeout for ReDoS testing, 80% coverage thresholds</done>
</task>

</tasks>

<verification>
Run these checks after all tasks complete:
1. `cat tsdown.config.ts | grep 'format.*esm.*cjs'` confirms dual output
2. `cat biome.json | grep -c '"error"'` returns at least 3 (strict linting enabled)
3. `cat vitest.config.ts | grep 'testTimeout'` confirms 10000ms timeout
4. All three config files are valid TypeScript/JSON (no syntax errors)
</verification>

<success_criteria>
Tooling configuration complete when:
- tsdown.config.ts configured for dual ESM/CJS output with minification
- biome.json enforces no any types with error severity
- vitest.config.ts ready for testing with ReDoS timeout and coverage tracking
- All configuration files are syntactically valid
- Tools ready for Phase 2 implementation work
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-architecture/01-02-SUMMARY.md`
</output>
