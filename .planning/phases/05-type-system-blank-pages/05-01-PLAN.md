---
phase: 05-type-system-blank-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/citation.ts
  - tests/extract/extractCase.test.ts
autonomous: true

must_haves:
  truths:
    - "FullCaseCitation.page is optional (page?: number) so blank-page citations compile"
    - "FullCaseCitation has optional hasBlankPage boolean field"
    - "FullCaseCitation has optional fullSpan, caseName, plaintiff, defendant fields"
    - "All existing tests pass unchanged (zero regressions)"
  artifacts:
    - path: "src/types/citation.ts"
      provides: "Extended FullCaseCitation interface with optional fields"
      contains: "hasBlankPage?: boolean"
    - path: "tests/extract/extractCase.test.ts"
      provides: "Backward compatibility verification tests"
      contains: "backward compatibility"
  key_links:
    - from: "src/types/citation.ts"
      to: "src/extract/extractCase.ts"
      via: "FullCaseCitation return type"
      pattern: "FullCaseCitation"
---

<objective>
Extend the FullCaseCitation type with optional fields for v1.1 features and verify backward compatibility.

Purpose: Enable blank page support and future party name extraction by adding optional fields to the type system without breaking any existing consumer code. This is the foundation for all Phase 5-8 work.

Output: Updated citation.ts with new optional fields, plus backward compatibility tests confirming all existing tests pass.
</objective>

<execution_context>
@/Users/medelman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/medelman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/citation.ts
@src/types/span.ts
@tests/extract/extractCase.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add optional fields to FullCaseCitation interface</name>
  <files>src/types/citation.ts</files>
  <action>
  Modify the `FullCaseCitation` interface in `src/types/citation.ts`:

  1. Change `page: number` to `page?: number` (make page optional for blank-page citations)
  2. Add the following optional fields after the existing `date?` field:
     - `fullSpan?: Span` - Full span from case name through closing parenthetical (Phase 6 will populate)
     - `caseName?: string` - Full case name (e.g., "Smith v. Jones") (Phase 6 will populate)
     - `plaintiff?: string` - Plaintiff party name (Phase 7 will populate)
     - `defendant?: string` - Defendant party name (Phase 7 will populate)
     - `hasBlankPage?: boolean` - True when page position contains placeholder (___/---)

  3. Add JSDoc comments for each new field explaining its purpose and which phase populates it.

  IMPORTANT: Do NOT change any other interface. Do NOT change the `page` field type on `FederalRegisterCitation`, `StatutesAtLargeCitation`, or `JournalCitation`. Only `FullCaseCitation.page` becomes optional.

  The `Span` import already exists at the top of the file. No new imports needed.

  WHY page must be optional: When a citation has "___" or "---" as a page placeholder, there is no numeric page to store. Setting page to undefined is cleaner than using a sentinel value like -1.
  </action>
  <verify>
  Run `pnpm typecheck` to verify the type changes compile without errors.
  Run `pnpm exec vitest run` to verify all existing tests still pass (some tests may need page assertions updated if they check for strict equality with a number -- but they should all pass since page is still set for normal citations).
  </verify>
  <done>
  - FullCaseCitation has `page?: number` (optional)
  - FullCaseCitation has `hasBlankPage?: boolean`
  - FullCaseCitation has `fullSpan?: Span`, `caseName?: string`, `plaintiff?: string`, `defendant?: string`
  - `pnpm typecheck` passes
  - `pnpm exec vitest run` passes (all existing tests green)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add backward compatibility verification tests</name>
  <files>tests/extract/extractCase.test.ts</files>
  <action>
  Add a new `describe('backward compatibility (QUAL-01)')` block at the end of the test file (before the closing of the file). These tests verify that:

  1. Normal citations still have numeric `page` field (not undefined):
     ```typescript
     it('normal citations still have numeric page field', () => {
       const citations = extractCitations('500 F.2d 123')
       expect(citations).toHaveLength(1)
       if (citations[0].type === 'case') {
         expect(citations[0].page).toBe(123)
         expect(typeof citations[0].page).toBe('number')
       }
     })
     ```

  2. New optional fields are undefined when not explicitly set:
     ```typescript
     it('new optional fields are undefined by default', () => {
       const citations = extractCitations('500 F.2d 123')
       expect(citations).toHaveLength(1)
       if (citations[0].type === 'case') {
         expect(citations[0].hasBlankPage).toBeUndefined()
         expect(citations[0].fullSpan).toBeUndefined()
         expect(citations[0].caseName).toBeUndefined()
         expect(citations[0].plaintiff).toBeUndefined()
         expect(citations[0].defendant).toBeUndefined()
       }
     })
     ```

  3. Existing citation structure unchanged (all fields from v1.0 still present):
     ```typescript
     it('all v1.0 citation fields still present and typed correctly', () => {
       const citations = extractCitations('410 U.S. 113 (1973)')
       expect(citations).toHaveLength(1)
       if (citations[0].type === 'case') {
         expect(citations[0].volume).toBe(410)
         expect(citations[0].reporter).toBe('U.S.')
         expect(citations[0].page).toBe(113)
         expect(citations[0].year).toBe(1973)
         expect(citations[0].court).toBe('scotus')
         expect(citations[0].text).toBeDefined()
         expect(citations[0].span).toBeDefined()
         expect(citations[0].confidence).toBeGreaterThan(0)
         expect(citations[0].matchedText).toBeDefined()
       }
     })
     ```

  These tests ensure QUAL-01 (all new fields optional, existing consumers unaffected).
  </action>
  <verify>
  Run `pnpm exec vitest run tests/extract/extractCase.test.ts` -- all new and existing tests pass.
  </verify>
  <done>
  - 3 new backward compatibility tests added
  - All tests pass (new + existing)
  - QUAL-01 requirement verified
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with zero errors
2. `pnpm exec vitest run` passes with all existing + new tests green
3. `pnpm lint` passes (no formatting or lint issues)
4. FullCaseCitation interface has all 5 new optional fields
5. No other citation interfaces modified
</verification>

<success_criteria>
- FullCaseCitation.page is optional (`page?: number`)
- 5 new optional fields added: fullSpan, caseName, plaintiff, defendant, hasBlankPage
- All 235+ existing tests pass unchanged
- 3 new backward compatibility tests pass
- Type system compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-type-system-blank-pages/05-01-SUMMARY.md`
</output>
