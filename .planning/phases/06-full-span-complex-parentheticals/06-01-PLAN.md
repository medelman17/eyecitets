---
phase: 06-full-span-complex-parentheticals
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/extract/dates.ts
  - tests/extract/dates.test.ts
autonomous: true

must_haves:
  truths:
    - "parseMonth converts abbreviated month names (Jan, Feb, ..., Dec) to numeric values 1-12"
    - "parseMonth handles full month names (January, February, ..., December)"
    - "parseMonth handles 'Sept' (4-letter abbreviation) and trailing periods"
    - "parseDate extracts structured date from abbreviated month format (Jan. 15, 2020)"
    - "parseDate extracts structured date from full month format (January 15, 2020)"
    - "parseDate extracts structured date from numeric US format (1/15/2020)"
    - "parseDate returns year-only structure when only year present"
    - "toIsoDate produces YYYY-MM-DD for full dates and YYYY for year-only"
  artifacts:
    - path: "src/extract/dates.ts"
      provides: "Date parsing utilities for legal citations"
      exports: ["parseMonth", "parseDate", "toIsoDate", "ParsedDate", "StructuredDate"]
    - path: "tests/extract/dates.test.ts"
      provides: "Unit tests for date parsing"
      min_lines: 60
  key_links:
    - from: "src/extract/dates.ts"
      to: "src/extract/extractCase.ts"
      via: "import { parseDate, toIsoDate } from './dates'"
      pattern: "import.*from.*dates"
---

<objective>
Create date parsing utilities for legal citation parentheticals.

Purpose: Phase 6 needs structured date extraction from parentheticals. The date module is a pure-function utility with clear inputs/outputs — ideal for TDD. This enables the unified parenthetical parser (Plan 06-02) to extract structured dates in all three required formats.

Output: `src/extract/dates.ts` with parseMonth, parseDate, toIsoDate functions and comprehensive tests.
</objective>

<execution_context>
@/Users/medelman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/medelman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-full-span-complex-parentheticals/06-RESEARCH.md

# Key existing infrastructure
@src/extract/extractCase.ts — Has MONTH_PATTERN and stripDateFromCourt() to reference
@src/types/citation.ts — Has date field shape: { iso: string, parsed?: { year, month?, day? } }
</context>

<feature>
  <name>Date Parsing Utilities</name>
  <files>src/extract/dates.ts, tests/extract/dates.test.ts</files>
  <behavior>
    parseMonth("Jan") -> 1
    parseMonth("January") -> 1
    parseMonth("Sept") -> 9
    parseMonth("Sept.") -> 9
    parseMonth("dec.") -> 12
    parseMonth("invalid") -> throws Error

    parseDate("Jan. 15, 2020") -> { iso: "2020-01-15", parsed: { year: 2020, month: 1, day: 15 } }
    parseDate("January 15, 2020") -> { iso: "2020-01-15", parsed: { year: 2020, month: 1, day: 15 } }
    parseDate("1/15/2020") -> { iso: "2020-01-15", parsed: { year: 2020, month: 1, day: 15 } }
    parseDate("2020") -> { iso: "2020", parsed: { year: 2020 } }
    parseDate("Feb 9, 2015") -> { iso: "2015-02-09", parsed: { year: 2015, month: 2, day: 9 } }
    parseDate("Sept. 30, 2019") -> { iso: "2019-09-30", parsed: { year: 2019, month: 9, day: 30 } }
    parseDate("12/25/2021") -> { iso: "2021-12-25", parsed: { year: 2021, month: 12, day: 25 } }
    parseDate("no date here") -> undefined

    toIsoDate({ year: 2020, month: 1, day: 15 }) -> "2020-01-15"
    toIsoDate({ year: 2020, month: 1 }) -> "2020-01"
    toIsoDate({ year: 2020 }) -> "2020"
  </behavior>
  <implementation>
    Create src/extract/dates.ts with:

    1. MONTH_MAP: Record<string, number> — maps lowercase month names/abbreviations to 1-12
       Include: jan, january, feb, february, ..., sep, sept, september, ..., dec, december

    2. parseMonth(monthStr: string): number
       - Normalize: lowercase, strip trailing period
       - Lookup in MONTH_MAP
       - Throw Error if not found

    3. ParsedDate interface: { year: number; month?: number; day?: number }
    4. StructuredDate interface: { iso: string; parsed: ParsedDate }

    5. parseDate(dateStr: string): StructuredDate | undefined
       - Try abbreviated month format first: /\b(Jan|Feb|...|Dec)\.?\s+(\d{1,2}),?\s+(\d{4})\b/i
       - Try full month format: /\b(January|February|...|December)\s+(\d{1,2}),?\s+(\d{4})\b/i
       - Try numeric US format: /\b(\d{1,2})\/(\d{1,2})\/(\d{4})\b/
       - Try year-only: /\b(\d{4})\b/
       - Return undefined if no match
       Each match builds { iso, parsed } using toIsoDate

    6. toIsoDate(parsed: ParsedDate): string
       - Full date: "YYYY-MM-DD" with zero-padded month/day
       - Month+year: "YYYY-MM"
       - Year only: "YYYY"

    Export all types and functions.
  </implementation>
</feature>

<verification>
pnpm exec vitest run tests/extract/dates.test.ts
</verification>

<success_criteria>
- All date parsing tests pass
- Three date formats handled: abbreviated month, full month, numeric
- Year-only format returns structured date with year only
- parseMonth handles abbreviated, full, 4-letter (Sept), with/without period
- toIsoDate properly zero-pads month and day values
- No runtime dependencies added
</success_criteria>

<output>
After completion, create `.planning/phases/06-full-span-complex-parentheticals/06-01-SUMMARY.md`
</output>
